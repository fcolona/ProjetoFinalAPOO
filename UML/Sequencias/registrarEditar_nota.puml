@startuml "registrarEditar_nota"

actor "Usuário" as User
participant "View"
participant "Controller"
participant "Model"
database "Banco de Dados" as DB

ref over User, View, Controller, Model, DB
  Caso de Uso: Listar Tarefas
end ref

User ->> View : Solicitar Registro/Edição de Nota
activate View

View ->> Controller : Requisição HTTP (PUT/PATCH)
deactivate View
activate Controller

' Validação explícita conforme descrito no Caso de Uso uc_grade
Controller -> Controller : Validar: É numérico e não negativo?

alt Dados Inválidos (Nota negativa ou formato texto)
    ' CASO DE ERRO 1: Validação de Formato falhou
    View <-- Controller : Resposta HTTP: 400 Bad Request
    activate View
    User <-- View : Mensagem: "A nota deve ser um número positivo."
    deactivate View

else Dados Válidos
    Controller -> Model : Registrar Nota
    activate Model

    ' O ID é usado para localizar a tarefa e o valor da nota é atualizado
    Model -> DB : Atualizar campo 'nota' da Tarefa (Update com ID)
    activate DB
    Model <-- DB : Resultado da Operação
    deactivate DB

    alt Erro do Banco de Dados
        ' CASO DE ERRO 2: Falha Interna
        Controller <-- Model : Exceção de Banco de Dados
        deactivate Model
        
        View <-- Controller : Resposta HTTP: 500 Internal Server Error
        activate View
        User <-- View : Mensagem: "Erro interno ao salvar nota."
        deactivate View
        
    else Tarefa não encontrada (ID inexistente)
        ' CASO DE ERRO 3: Recurso não encontrado
        Controller <-- Model : Retorno null
        deactivate Model
        
        View <-- Controller : Resposta HTTP: 404 Not Found
        activate View
        User <-- View : Mensagem: "Erro: A tarefa não existe."
        deactivate View
        
    else Sucesso
        ' Caminho de Sucesso
        Controller <-- Model : Nota registrada com sucesso
        deactivate Model
        
        View <-- Controller : Resposta HTTP: 200 OK
        deactivate Controller
            
        activate View
        User <-- View : Exibir nova nota atualizada na lista
        deactivate View
    end
end

@enduml